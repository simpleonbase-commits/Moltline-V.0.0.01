<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAI Vesting Terminal - Bureau of Agent Investigations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0f;
            color: #00ff00;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 20px;
            border-bottom: 1px solid #1a3d1a;
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        h1 {
            font-size: 2rem;
            color: #00ff00;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00ff00;
        }
        
        .tagline {
            color: #00aa00;
            font-size: 0.9rem;
        }
        
        .terminal {
            background: #0d1f0d;
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
        }
        
        .terminal-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 15px;
            border-bottom: 1px solid #1a3d1a;
            margin-bottom: 15px;
        }
        
        .terminal-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .dot-red { background: #ff5f56; }
        .dot-yellow { background: #ffbd2e; }
        .dot-green { background: #27ca40; }
        
        .terminal-title {
            color: #888;
            font-size: 0.85rem;
            margin-left: 10px;
        }
        
        .terminal-content {
            font-size: 0.9rem;
        }
        
        .line {
            margin-bottom: 8px;
        }
        
        .prompt {
            color: #00ff00;
        }
        
        .command {
            color: #fff;
        }
        
        .output {
            color: #00aa00;
            padding-left: 20px;
        }
        
        .highlight {
            color: #00ff00;
            font-weight: bold;
        }
        
        .warning {
            color: #ffd700;
        }
        
        .error {
            color: #ff4444;
        }
        
        .success {
            color: #00ff00;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #0d1f0d;
            border: 1px solid #1a3d1a;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            color: #00ff00;
            font-weight: bold;
            text-shadow: 0 0 10px #00ff00;
        }
        
        .stat-label {
            color: #00aa00;
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        .deposits-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .deposits-table th,
        .deposits-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #1a3d1a;
        }
        
        .deposits-table th {
            color: #00ff00;
            font-weight: bold;
            background: #0a150a;
        }
        
        .deposits-table td {
            color: #00aa00;
        }
        
        .status-locked {
            color: #ff4444;
        }
        
        .status-unlocked {
            color: #00ff00;
        }
        
        .contract-info {
            background: #0a150a;
            border: 1px solid #1a3d1a;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .contract-info a {
            color: #00ff00;
            text-decoration: none;
        }
        
        .contract-info a:hover {
            text-decoration: underline;
        }
        
        .loading {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .back-link {
            display: inline-block;
            color: #00ff00;
            text-decoration: none;
            margin-bottom: 20px;
            padding: 8px 16px;
            border: 1px solid #00ff00;
            border-radius: 4px;
        }
        
        .back-link:hover {
            background: #00ff00;
            color: #000;
        }
        
        footer {
            text-align: center;
            padding: 30px 20px;
            border-top: 1px solid #1a3d1a;
            color: #00aa00;
            font-size: 0.85rem;
            margin-top: 40px;
        }
        
        footer a {
            color: #00ff00;
            text-decoration: none;
        }
        
        @media (max-width: 600px) {
            h1 { font-size: 1.5rem; }
            .stat-value { font-size: 1.4rem; }
            .deposits-table { font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Bureau</a>
        
        <header>
            <div class="logo">üîí</div>
            <h1>BAI VESTING TERMINAL</h1>
            <p class="tagline">2-Year Token Lock ‚Ä¢ Community Trust Infrastructure</p>
        </header>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="total-locked">--</div>
                <div class="stat-label">Total testBAI Locked</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-deposits">--</div>
                <div class="stat-label">Total Deposits</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="unique-depositors">--</div>
                <div class="stat-label">Unique Depositors</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="next-unlock">--</div>
                <div class="stat-label">Next Unlock</div>
            </div>
        </div>
        
        <div class="terminal">
            <div class="terminal-header">
                <div class="terminal-dot dot-red"></div>
                <div class="terminal-dot dot-yellow"></div>
                <div class="terminal-dot dot-green"></div>
                <span class="terminal-title">bai-vesting-monitor v1.0.0</span>
            </div>
            <div class="terminal-content">
                <div class="line">
                    <span class="prompt">$</span> <span class="command">status --contract</span>
                </div>
                <div class="line output">
                    <span class="success">‚úì</span> Contract: 0xfC5944055F1877320fc87feFCE0F845C507B0988
                </div>
                <div class="line output">
                    <span class="success">‚úì</span> Network: Base Mainnet (Chain ID: 8453)
                </div>
                <div class="line output">
                    <span class="success">‚úì</span> Verified: BaseScan + Sourcify
                </div>
                <div class="line output">
                    <span class="success">‚úì</span> Lock Period: 730 days (2 years)
                </div>
                <div class="line" style="margin-top: 15px;">
                    <span class="prompt">$</span> <span class="command">fetch --deposits</span>
                </div>
                <div class="line output" id="fetch-status">
                    <span class="loading">‚ñà</span> Querying blockchain...
                </div>
            </div>
        </div>
        
        <div class="terminal" id="deposits-terminal" style="display: none;">
            <div class="terminal-header">
                <div class="terminal-dot dot-red"></div>
                <div class="terminal-dot dot-yellow"></div>
                <div class="terminal-dot dot-green"></div>
                <span class="terminal-title">deposit-ledger</span>
            </div>
            <div class="terminal-content">
                <div class="line">
                    <span class="prompt">$</span> <span class="command">list --all-deposits</span>
                </div>
                <table class="deposits-table" id="deposits-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Depositor</th>
                            <th>Amount</th>
                            <th>Deposit Date</th>
                            <th>Unlock Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="deposits-body">
                    </tbody>
                </table>
                <div id="no-deposits" style="display: none; padding: 20px; text-align: center; color: #00aa00;">
                    No deposits yet. Be the first to show your commitment! üîí
                </div>
            </div>
        </div>
        
        <div class="contract-info">
            <div class="line">
                <span class="prompt">CONTRACT INFO</span>
            </div>
            <div class="line output">
                Token: <a href="https://basescan.org/token/0x2ca8b2b97bc0f0ccdd875dcfeff16b868a1b5ba3" target="_blank">testBAI (0x2ca8...5ba3)</a>
            </div>
            <div class="line output">
                Vesting: <a href="https://basescan.org/address/0xfC5944055F1877320fc87feFCE0F845C507B0988#code" target="_blank">BAIVesting (0xfC59...0988)</a>
            </div>
            <div class="line output">
                Features: No admin, no owner, permissionless, 2-year lock per deposit
            </div>
            <div class="line output">
                Source: <a href="https://github.com/simpleonbase-commits/BAI-V.0.0.01/tree/main/vesting-v2" target="_blank">GitHub (Audited)</a>
            </div>
        </div>
        
        <footer>
            <p>Bureau of Agent Investigations ‚Äî Trust Infrastructure for the Agent Economy üèõÔ∏è</p>
            <p style="margin-top: 10px;">
                <a href="index.html">Home</a> ‚Ä¢ 
                <a href="https://basescan.org/address/0xfC5944055F1877320fc87feFCE0F845C507B0988#code" target="_blank">Verify Contract</a> ‚Ä¢ 
                <a href="https://github.com/simpleonbase-commits/BAI-V.0.0.01" target="_blank">GitHub</a>
            </p>
        </footer>
    </div>
    
    <script>
        // Contract addresses
        const VESTING_CONTRACT = '0xfC5944055F1877320fc87feFCE0F845C507B0988';
        const TOKEN_CONTRACT = '0x2ca8b2b97bc0f0ccdd875dcfeff16b868a1b5ba3';
        const BASE_RPC = 'https://mainnet.base.org';
        
        // ABI fragments
        const DEPOSIT_EVENT_TOPIC = '0xe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c'; // Deposited event
        const WITHDRAWN_EVENT_TOPIC = '0x7fcf532c15f0a6db0bd6d0e038bea71d30d808c7d98cb3bf7268a95bf5081b65'; // Withdrawn event
        
        // Deposit(address depositor, uint256 amount, uint256 depositId, uint256 unlockTime)
        const DEPOSIT_TOPIC = '0x90890809c654f11d6e72a28fa60149770a0d11ec6c92319d6ceb2bb0a4ea1a15';
        
        async function fetchDeposits() {
            try {
                // Get Deposited events
                const response = await fetch(BASE_RPC, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'eth_getLogs',
                        params: [{
                            address: VESTING_CONTRACT,
                            fromBlock: '0x0',
                            toBlock: 'latest',
                            topics: [DEPOSIT_TOPIC]
                        }]
                    })
                });
                
                const data = await response.json();
                const logs = data.result || [];
                
                // Parse deposits
                const deposits = logs.map((log, index) => {
                    const depositor = '0x' + log.topics[1].slice(26);
                    const amount = BigInt(log.data.slice(0, 66));
                    const depositId = BigInt('0x' + log.data.slice(66, 130));
                    const unlockTime = BigInt('0x' + log.data.slice(130, 194));
                    
                    return {
                        depositor,
                        amount,
                        depositId,
                        unlockTime,
                        blockNumber: parseInt(log.blockNumber, 16),
                        txHash: log.transactionHash
                    };
                });
                
                return deposits;
            } catch (error) {
                console.error('Error fetching deposits:', error);
                return [];
            }
        }
        
        function formatAmount(wei) {
            const amount = Number(wei) / 1e18;
            if (amount >= 1000000) return (amount / 1000000).toFixed(2) + 'M';
            if (amount >= 1000) return (amount / 1000).toFixed(2) + 'K';
            return amount.toFixed(2);
        }
        
        function formatAddress(addr) {
            return addr.slice(0, 6) + '...' + addr.slice(-4);
        }
        
        function formatDate(timestamp) {
            const date = new Date(Number(timestamp) * 1000);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }
        
        function formatTimeRemaining(unlockTime) {
            const now = Math.floor(Date.now() / 1000);
            const remaining = Number(unlockTime) - now;
            
            if (remaining <= 0) return 'UNLOCKED';
            
            const days = Math.floor(remaining / 86400);
            const hours = Math.floor((remaining % 86400) / 3600);
            
            if (days > 365) {
                const years = (days / 365).toFixed(1);
                return years + 'y';
            }
            if (days > 0) return days + 'd ' + hours + 'h';
            return hours + 'h';
        }
        
        async function updateUI() {
            const deposits = await fetchDeposits();
            
            // Update fetch status
            const fetchStatus = document.getElementById('fetch-status');
            fetchStatus.innerHTML = `<span class="success">‚úì</span> Found ${deposits.length} deposit(s)`;
            
            // Calculate stats
            let totalLocked = BigInt(0);
            const uniqueDepositors = new Set();
            let nextUnlock = null;
            const now = Math.floor(Date.now() / 1000);
            
            deposits.forEach(d => {
                totalLocked += d.amount;
                uniqueDepositors.add(d.depositor.toLowerCase());
                
                if (Number(d.unlockTime) > now) {
                    if (!nextUnlock || d.unlockTime < nextUnlock) {
                        nextUnlock = d.unlockTime;
                    }
                }
            });
            
            // Update stat cards
            document.getElementById('total-locked').textContent = formatAmount(totalLocked);
            document.getElementById('total-deposits').textContent = deposits.length;
            document.getElementById('unique-depositors').textContent = uniqueDepositors.size;
            document.getElementById('next-unlock').textContent = nextUnlock ? formatTimeRemaining(nextUnlock) : 'N/A';
            
            // Show deposits terminal
            const depositsTerminal = document.getElementById('deposits-terminal');
            depositsTerminal.style.display = 'block';
            
            // Populate table
            const tbody = document.getElementById('deposits-body');
            const noDeposits = document.getElementById('no-deposits');
            
            if (deposits.length === 0) {
                noDeposits.style.display = 'block';
            } else {
                tbody.innerHTML = deposits.map((d, i) => {
                    const isUnlocked = Number(d.unlockTime) <= now;
                    const depositDate = formatDate(BigInt(d.unlockTime) - BigInt(730 * 86400));
                    
                    return `
                        <tr>
                            <td>${i + 1}</td>
                            <td><a href="https://basescan.org/address/${d.depositor}" target="_blank" style="color: #00ff00;">${formatAddress(d.depositor)}</a></td>
                            <td>${formatAmount(d.amount)} BAI</td>
                            <td>${depositDate}</td>
                            <td>${formatDate(d.unlockTime)}</td>
                            <td class="${isUnlocked ? 'status-unlocked' : 'status-locked'}">
                                ${isUnlocked ? '‚úì UNLOCKED' : 'üîí ' + formatTimeRemaining(d.unlockTime)}
                            </td>
                        </tr>
                    `;
                }).join('');
            }
        }
        
        // Initialize
        updateUI();
        
        // Refresh every 60 seconds
        setInterval(updateUI, 60000);
    </script>
</body>
</html>