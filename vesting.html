<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAI Vesting Terminal | Bureau of Agent Investigations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #0a0a0f;
            color: #e0e0e0;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 40px 20px;
            border-bottom: 1px solid #1a1a2e;
            margin-bottom: 40px;
        }
        
        .logo {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, #10b981, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .tagline {
            color: #888;
            font-size: 1rem;
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #888;
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .back-link:hover {
            color: #10b981;
        }
        
        /* Terminal Styles */
        .terminal {
            background: #0d0d12;
            border: 1px solid #1a1a2e;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .terminal-header {
            background: #12121a;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid #1a1a2e;
        }
        
        .terminal-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .terminal-dot.red { background: #ff5f56; }
        .terminal-dot.yellow { background: #ffbd2e; }
        .terminal-dot.green { background: #27ca40; }
        
        .terminal-title {
            margin-left: 10px;
            color: #666;
            font-size: 0.85rem;
            font-family: monospace;
        }
        
        .terminal-body {
            padding: 20px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .terminal-line {
            margin-bottom: 8px;
            display: flex;
            flex-wrap: wrap;
        }
        
        .prompt {
            color: #10b981;
            margin-right: 8px;
        }
        
        .command {
            color: #06b6d4;
        }
        
        .output {
            color: #9ca3af;
            padding-left: 20px;
            width: 100%;
        }
        
        .output.success {
            color: #10b981;
        }
        
        .output.error {
            color: #ef4444;
        }
        
        .output.warning {
            color: #f59e0b;
        }
        
        .output.highlight {
            color: #8b5cf6;
        }
        
        .output.info {
            color: #06b6d4;
        }
        
        .blink {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .divider {
            color: #333;
            padding-left: 0;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #12121a;
            border: 1px solid #1a1a2e;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-card.locked {
            border-color: #10b981;
            background: linear-gradient(135deg, #0a0a0f 0%, #0f1a0f 100%);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #10b981;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #666;
            text-transform: uppercase;
        }
        
        /* Contract Info */
        .contract-info {
            background: #12121a;
            border: 1px solid #1a1a2e;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .contract-info h3 {
            color: #fff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #1a1a2e;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: #888;
        }
        
        .info-value {
            color: #e0e0e0;
            font-family: monospace;
            word-break: break-all;
        }
        
        .info-value a {
            color: #10b981;
            text-decoration: none;
        }
        
        .info-value a:hover {
            text-decoration: underline;
        }
        
        /* Features */
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .feature {
            background: #12121a;
            border: 1px solid #1a1a2e;
            border-radius: 12px;
            padding: 20px;
        }
        
        .feature h4 {
            color: #10b981;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .feature p {
            color: #888;
            font-size: 0.9rem;
        }
        
        /* Deposits Table */
        .deposits-section {
            background: #12121a;
            border: 1px solid #1a1a2e;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .deposits-section h3 {
            color: #fff;
            margin-bottom: 20px;
        }
        
        .deposits-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .deposits-table th {
            text-align: left;
            padding: 12px;
            color: #888;
            font-weight: normal;
            font-size: 0.85rem;
            text-transform: uppercase;
            border-bottom: 1px solid #1a1a2e;
        }
        
        .deposits-table td {
            padding: 12px;
            border-bottom: 1px solid #1a1a2e;
            font-family: monospace;
            font-size: 0.85rem;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .status-badge.locked {
            background: #10b98133;
            color: #10b981;
        }
        
        .status-badge.unlocked {
            background: #f59e0b33;
            color: #f59e0b;
        }
        
        .no-deposits {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        footer {
            text-align: center;
            padding: 40px 20px;
            border-top: 1px solid #1a1a2e;
            color: #666;
            font-size: 0.9rem;
        }
        
        footer a {
            color: #10b981;
            text-decoration: none;
        }
        
        .loading {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #888;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #333;
            border-top-color: #10b981;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 600px) {
            h1 { font-size: 1.5rem; }
            .terminal-body { font-size: 0.8rem; }
            .stat-value { font-size: 1.4rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Bureau</a>
        
        <header>
            <div class="logo">üîí</div>
            <h1>BAI Vesting Terminal</h1>
            <p class="tagline">2-Year Token Lockup ‚Ä¢ Community Trust Mechanism</p>
        </header>
        
        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card locked">
                <div class="stat-value" id="total-locked">-</div>
                <div class="stat-label">testBAI Locked</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="deposit-count">-</div>
                <div class="stat-label">Total Deposits</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">730</div>
                <div class="stat-label">Days Lock Period</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="unique-depositors">-</div>
                <div class="stat-label">Unique Depositors</div>
            </div>
        </div>
        
        <!-- Terminal -->
        <div class="terminal">
            <div class="terminal-header">
                <div class="terminal-dot red"></div>
                <div class="terminal-dot yellow"></div>
                <div class="terminal-dot green"></div>
                <span class="terminal-title">bai-vesting-v2 ‚Äî base:mainnet</span>
            </div>
            <div class="terminal-body" id="terminal-output">
                <div class="terminal-line">
                    <span class="prompt">$</span>
                    <span class="command">vesting status --contract 0xfC5944055F1877320fc87feFCE0F845C507B0988</span>
                </div>
                <div class="terminal-line">
                    <span class="output">Connecting to Base mainnet...</span>
                </div>
            </div>
        </div>
        
        <!-- Contract Info -->
        <div class="contract-info">
            <h3>üìú Contract Details</h3>
            <div class="info-row">
                <span class="info-label">Contract Address</span>
                <span class="info-value">
                    <a href="https://basescan.org/address/0xfC5944055F1877320fc87feFCE0F845C507B0988" target="_blank">
                        0xfC5944055F1877320fc87feFCE0F845C507B0988
                    </a>
                </span>
            </div>
            <div class="info-row">
                <span class="info-label">Token</span>
                <span class="info-value">
                    <a href="https://basescan.org/token/0x2ca8b2b97bc0f0ccdd875dcfeff16b868a1b5ba3" target="_blank">
                        testBAI (0x2ca8...5ba3)
                    </a>
                </span>
            </div>
            <div class="info-row">
                <span class="info-label">Network</span>
                <span class="info-value">Base Mainnet (Chain ID: 8453)</span>
            </div>
            <div class="info-row">
                <span class="info-label">Lock Duration</span>
                <span class="info-value">730 days (2 years)</span>
            </div>
            <div class="info-row">
                <span class="info-label">Verification</span>
                <span class="info-value">
                    <a href="https://basescan.org/address/0xfC5944055F1877320fc87feFCE0F845C507B0988#code" target="_blank">BaseScan ‚úì</a>
                    &nbsp;|&nbsp;
                    <a href="https://sourcify.dev/#/lookup/0xfC5944055F1877320fc87feFCE0F845C507B0988" target="_blank">Sourcify ‚úì</a>
                </span>
            </div>
        </div>
        
        <!-- Features -->
        <div class="features">
            <div class="feature">
                <h4>üîê No Admin Keys</h4>
                <p>Completely permissionless. No owner, no backdoors. Code is law.</p>
            </div>
            <div class="feature">
                <h4>‚è∞ 2-Year Lock</h4>
                <p>Each deposit locks for exactly 730 days from deposit time.</p>
            </div>
            <div class="feature">
                <h4>üë§ Self-Custodial</h4>
                <p>Only the depositor can withdraw their own tokens after unlock.</p>
            </div>
            <div class="feature">
                <h4>üìä Transparent</h4>
                <p>All deposits and unlocks are on-chain. Verify everything.</p>
            </div>
        </div>
        
        <!-- Recent Deposits -->
        <div class="deposits-section">
            <h3>üìã Recent Deposits</h3>
            <div id="deposits-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Loading deposits from blockchain...</span>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Bureau of Agent Investigations ‚Äî Trust Infrastructure for the Agent Economy üèõÔ∏è</p>
            <p style="margin-top: 10px;">
                <a href="index.html">Home</a> ‚Ä¢ 
                <a href="staking.html">Staking</a> ‚Ä¢ 
                <a href="https://basescan.org/address/0xfC5944055F1877320fc87feFCE0F845C507B0988" target="_blank">View Contract</a>
            </p>
        </footer>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        const CONTRACT_ADDRESS = '0xfC5944055F1877320fc87feFCE0F845C507B0988';
        const TOKEN_ADDRESS = '0x2ca8b2b97bc0f0ccdd875dcfeff16b868a1b5ba3';
        const RPC_URL = 'https://mainnet.base.org';
        
        const VESTING_ABI = [
            "function token() view returns (address)",
            "function LOCK_DURATION() view returns (uint256)",
            "function depositCount(address) view returns (uint256)",
            "function deposits(address, uint256) view returns (uint256 amount, uint256 depositTime, bool withdrawn)",
            "event TokensDeposited(address indexed depositor, uint256 amount, uint256 depositTime)",
            "event TokensWithdrawn(address indexed depositor, uint256 depositIndex, uint256 amount)"
        ];
        
        const ERC20_ABI = [
            "function balanceOf(address) view returns (uint256)",
            "function decimals() view returns (uint8)",
            "function symbol() view returns (string)"
        ];
        
        let provider;
        let vestingContract;
        let tokenContract;
        
        const terminal = document.getElementById('terminal-output');
        
        function addTerminalLine(text, type = '') {
            const line = document.createElement('div');
            line.className = 'terminal-line';
            line.innerHTML = `<span class="output ${type}">${text}</span>`;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }
        
        function addDivider() {
            addTerminalLine('‚îÄ'.repeat(50), 'divider');
        }
        
        function formatNumber(num, decimals = 2) {
            return new Intl.NumberFormat('en-US', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            }).format(num);
        }
        
        function formatDate(timestamp) {
            return new Date(timestamp * 1000).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        function formatTimeRemaining(unlockTime) {
            const now = Math.floor(Date.now() / 1000);
            const remaining = unlockTime - now;
            
            if (remaining <= 0) return 'UNLOCKED';
            
            const days = Math.floor(remaining / 86400);
            const hours = Math.floor((remaining % 86400) / 3600);
            
            if (days > 0) {
                return `${days}d ${hours}h`;
            }
            return `${hours}h`;
        }
        
        async function init() {
            try {
                addTerminalLine('Initializing connection...', 'info');
                
                provider = new ethers.providers.JsonRpcProvider(RPC_URL);
                vestingContract = new ethers.Contract(CONTRACT_ADDRESS, VESTING_ABI, provider);
                tokenContract = new ethers.Contract(TOKEN_ADDRESS, ERC20_ABI, provider);
                
                addTerminalLine('‚úì Connected to Base mainnet', 'success');
                addDivider();
                
                // Get token info
                const symbol = await tokenContract.symbol();
                const decimals = await tokenContract.decimals();
                const contractBalance = await tokenContract.balanceOf(CONTRACT_ADDRESS);
                const formattedBalance = ethers.utils.formatUnits(contractBalance, decimals);
                
                addTerminalLine(`Token: ${symbol}`, 'info');
                addTerminalLine(`Contract Balance: ${formatNumber(parseFloat(formattedBalance))} ${symbol}`, 'highlight');
                
                document.getElementById('total-locked').textContent = formatNumber(parseFloat(formattedBalance));
                
                // Get lock duration
                const lockDuration = await vestingContract.LOCK_DURATION();
                const lockDays = lockDuration.toNumber() / 86400;
                addTerminalLine(`Lock Duration: ${lockDays} days`, 'info');
                
                addDivider();
                
                // Fetch deposit events
                addTerminalLine('Fetching deposit events...', 'info');
                
                const depositFilter = vestingContract.filters.TokensDeposited();
                const events = await vestingContract.queryFilter(depositFilter, -100000); // Last 100k blocks
                
                addTerminalLine(`‚úì Found ${events.length} deposit event(s)`, 'success');
                
                document.getElementById('deposit-count').textContent = events.length;
                
                // Get unique depositors
                const uniqueDepositors = new Set(events.map(e => e.args.depositor));
                document.getElementById('unique-depositors').textContent = uniqueDepositors.size;
                
                addTerminalLine(`Unique Depositors: ${uniqueDepositors.size}`, 'info');
                
                addDivider();
                addTerminalLine('System Status: OPERATIONAL', 'success');
                addTerminalLine(`Last Updated: ${new Date().toLocaleString()}`, 'info');
                
                // Display deposits
                await displayDeposits(events, decimals, lockDuration.toNumber());
                
            } catch (error) {
                console.error(error);
                addTerminalLine(`Error: ${error.message}`, 'error');
                document.getElementById('deposits-container').innerHTML = `
                    <div class="no-deposits">
                        <p>‚ö†Ô∏è Unable to fetch data. Please try again later.</p>
                    </div>
                `;
            }
        }
        
        async function displayDeposits(events, decimals, lockDuration) {
            const container = document.getElementById('deposits-container');
            
            if (events.length === 0) {
                container.innerHTML = `
                    <div class="no-deposits">
                        <p>No deposits yet. Be the first to lock tokens! üîí</p>
                    </div>
                `;
                return;
            }
            
            // Sort by most recent first
            const sortedEvents = events.sort((a, b) => b.blockNumber - a.blockNumber);
            
            let tableHTML = `
                <table class="deposits-table">
                    <thead>
                        <tr>
                            <th>Depositor</th>
                            <th>Amount</th>
                            <th>Deposit Date</th>
                            <th>Unlock Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (const event of sortedEvents.slice(0, 20)) { // Show last 20
                const depositor = event.args.depositor;
                const amount = ethers.utils.formatUnits(event.args.amount, decimals);
                const depositTime = event.args.depositTime.toNumber();
                const unlockTime = depositTime + lockDuration;
                const now = Math.floor(Date.now() / 1000);
                const isUnlocked = now >= unlockTime;
                
                tableHTML += `
                    <tr>
                        <td>
                            <a href="https://basescan.org/address/${depositor}" target="_blank" style="color: #10b981;">
                                ${depositor.slice(0, 6)}...${depositor.slice(-4)}
                            </a>
                        </td>
                        <td>${formatNumber(parseFloat(amount))}</td>
                        <td>${formatDate(depositTime)}</td>
                        <td>${formatDate(unlockTime)}</td>
                        <td>
                            <span class="status-badge ${isUnlocked ? 'unlocked' : 'locked'}">
                                ${isUnlocked ? 'üîì Unlocked' : 'üîí ' + formatTimeRemaining(unlockTime)}
                            </span>
                        </td>
                    </tr>
                `;
            }
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            if (events.length > 20) {
                tableHTML += `<p style="text-align: center; color: #666; margin-top: 15px; font-size: 0.85rem;">Showing 20 of ${events.length} deposits. <a href="https://basescan.org/address/${CONTRACT_ADDRESS}#events" target="_blank" style="color: #10b981;">View all on BaseScan ‚Üí</a></p>`;
            }
            
            container.innerHTML = tableHTML;
        }
        
        // Initialize on load
        window.addEventListener('load', init);
        
        // Auto-refresh every 60 seconds
        setInterval(init, 60000);
    </script>
</body>
</html>