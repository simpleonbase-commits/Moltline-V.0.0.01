<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíé Diamond Hands Staking - Bureau of Agent Investigations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #0a0a0f;
            color: #e0e0e0;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 40px 20px;
            border-bottom: 1px solid #1a1a2e;
            margin-bottom: 40px;
        }
        
        .logo {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .tagline {
            color: #888;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #ffa500;
            font-size: 1.3rem;
            font-weight: bold;
            font-style: italic;
        }
        
        /* Connect Wallet */
        .connect-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .connect-btn {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            color: #000;
            border: none;
            padding: 15px 40px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .connect-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 107, 107, 0.4);
        }

        .connect-btn:disabled {
            background: #333;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .wallet-info {
            background: #12121a;
            border: 1px solid #1a1a2e;
            border-radius: 12px;
            padding: 15px 25px;
            display: inline-block;
            margin-top: 15px;
        }

        .wallet-address {
            font-family: monospace;
            color: #4ade80;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: #12121a;
            border: 1px solid #1a1a2e;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            transition: border-color 0.3s;
        }

        .stat-card:hover {
            border-color: #333;
        }

        .stat-card.highlight {
            border-color: #ffa500;
            background: linear-gradient(135deg, #12121a 0%, #1a1510 100%);
        }

        .stat-label {
            color: #888;
            font-size: 0.9rem;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #fff;
        }

        .stat-value.green {
            color: #4ade80;
        }

        .stat-value.orange {
            color: #ffa500;
        }

        .stat-value.red {
            color: #ff6b6b;
        }

        /* Main Staking Panel */
        .staking-panel {
            background: #12121a;
            border: 1px solid #1a1a2e;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #1a1a2e;
        }

        .panel-title {
            font-size: 1.5rem;
            color: #fff;
        }

        .panel-badge {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            color: #000;
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .tab {
            flex: 1;
            padding: 12px 20px;
            background: #1a1a2e;
            border: none;
            border-radius: 10px;
            color: #888;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #252538;
        }

        .tab.active {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            color: #000;
        }

        /* Input Section */
        .input-section {
            margin-bottom: 20px;
        }

        .input-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #888;
            font-size: 0.9rem;
        }

        .balance-link {
            color: #ffa500;
            cursor: pointer;
            text-decoration: underline;
        }

        .input-wrapper {
            display: flex;
            background: #0a0a0f;
            border: 2px solid #1a1a2e;
            border-radius: 12px;
            overflow: hidden;
            transition: border-color 0.3s;
        }

        .input-wrapper:focus-within {
            border-color: #ffa500;
        }

        .amount-input {
            flex: 1;
            background: transparent;
            border: none;
            padding: 18px 20px;
            color: #fff;
            font-size: 1.3rem;
            outline: none;
        }

        .amount-input::placeholder {
            color: #444;
        }

        .token-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 20px;
            background: #1a1a2e;
            color: #fff;
            font-weight: 600;
        }

        .max-btn {
            background: transparent;
            border: 1px solid #ffa500;
            color: #ffa500;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 10px;
            transition: all 0.3s;
        }

        .max-btn:hover {
            background: #ffa500;
            color: #000;
        }

        /* Action Button */
        .action-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            color: #000;
        }

        .action-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }

        .action-btn.secondary {
            background: #1a1a2e;
            color: #fff;
            border: 1px solid #333;
        }

        .action-btn.secondary:hover {
            background: #252538;
        }

        .action-btn:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Info Box */
        .info-box {
            background: #1a1510;
            border: 1px solid #3d2a1a;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }

        .info-box.warning {
            background: #1f1a0d;
            border-color: #3d3a1a;
        }

        .info-box.success {
            background: #0d1f0d;
            border-color: #1a3d1a;
        }

        .info-box h4 {
            color: #ffa500;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .info-box.warning h4 {
            color: #ffd700;
        }

        .info-box.success h4 {
            color: #4ade80;
        }

        .info-box p {
            color: #d8c0a0;
            font-size: 0.9rem;
        }

        .info-box.warning p {
            color: #d8d0a0;
        }

        .info-box.success p {
            color: #a0d8a0;
        }

        /* Your Position */
        .position-card {
            background: linear-gradient(135deg, #12121a 0%, #0f1a0f 100%);
            border: 1px solid #1a3d1a;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .position-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .position-title {
            font-size: 1.3rem;
            color: #4ade80;
        }

        .position-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .position-item {
            text-align: center;
        }

        .position-label {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .position-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: #fff;
        }

        /* How It Works */
        .how-it-works {
            background: #12121a;
            border: 1px solid #1a1a2e;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
        }

        .how-it-works h2 {
            margin-bottom: 20px;
            color: #fff;
        }

        .steps {
            display: grid;
            gap: 20px;
        }

        .step {
            display: flex;
            gap: 15px;
        }

        .step-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .step-content h3 {
            color: #fff;
            margin-bottom: 5px;
        }

        .step-content p {
            color: #888;
            font-size: 0.95rem;
        }

        /* Contract Info */
        .contract-info {
            background: #12121a;
            border: 1px solid #1a1a2e;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .contract-info a {
            color: #ffa500;
            text-decoration: none;
        }

        .contract-info a:hover {
            text-decoration: underline;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 40px 20px;
            border-top: 1px solid #1a1a2e;
            color: #666;
            font-size: 0.9rem;
        }

        footer a {
            color: #ff6b6b;
            text-decoration: none;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #12121a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 15px 25px;
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            border-color: #4ade80;
        }

        .toast.error {
            border-color: #ff6b6b;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #333;
            border-top-color: #ffa500;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Nav */
        .nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .nav a {
            color: #888;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .nav a:hover {
            color: #fff;
            background: #1a1a2e;
        }

        @media (max-width: 600px) {
            h1 { font-size: 1.8rem; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .tabs { flex-direction: column; }
            .position-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <nav class="nav">
                <a href="index.html">üèõÔ∏è Cases</a>
                <a href="registry.html">üìã Registry</a>
                <a href="blacklist.html">üö´ Blacklist</a>
                <a href="staking.html" style="color: #ffa500;">üíé Staking</a>
            </nav>
            <div class="logo">üíé</div>
            <h1>Diamond Hands Staking</h1>
            <p class="tagline">Bureau of Agent Investigations</p>
            <p class="subtitle">"Paper Hands Pay, Diamond Hands Gain"</p>
        </header>

        <!-- Connect Wallet -->
        <div class="connect-section">
            <button class="connect-btn" id="connectBtn" onclick="connectWallet()">
                üîó Connect Wallet
            </button>
            <div class="wallet-info" id="walletInfo" style="display: none;">
                Connected: <span class="wallet-address" id="walletAddress"></span>
            </div>
        </div>

        <!-- Global Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Staked</div>
                <div class="stat-value" id="totalStaked">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Lock Period</div>
                <div class="stat-value">7 Days</div>
            </div>
            <div class="stat-card highlight">
                <div class="stat-label">Early Exit Penalty</div>
                <div class="stat-value red">20%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Your Rewards</div>
                <div class="stat-value green" id="pendingRewards">--</div>
            </div>
        </div>

        <!-- Your Position -->
        <div class="position-card" id="positionCard" style="display: none;">
            <div class="position-header">
                <h3 class="position-title">üíé Your Position</h3>
                <span id="lockStatus" style="color: #4ade80;">üîì Unlocked</span>
            </div>
            <div class="position-grid">
                <div class="position-item">
                    <div class="position-label">Staked Amount</div>
                    <div class="position-value" id="yourStaked">0 SIMPLE</div>
                </div>
                <div class="position-item">
                    <div class="position-label">Pending Rewards</div>
                    <div class="position-value" style="color: #4ade80;" id="yourRewards">0 SIMPLE</div>
                </div>
                <div class="position-item">
                    <div class="position-label">Unlock Time</div>
                    <div class="position-value" id="unlockTime">--</div>
                </div>
                <div class="position-item">
                    <div class="position-label">Early Exit Cost</div>
                    <div class="position-value" style="color: #ff6b6b;" id="exitPenalty">0 SIMPLE</div>
                </div>
            </div>
        </div>

        <!-- Staking Panel -->
        <div class="staking-panel">
            <div class="panel-header">
                <h2 class="panel-title">Stake SIMPLE</h2>
                <span class="panel-badge">üíé DIAMOND HANDS</span>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('stake')" id="stakeTab">Stake</button>
                <button class="tab" onclick="switchTab('unstake')" id="unstakeTab">Unstake</button>
                <button class="tab" onclick="switchTab('claim')" id="claimTab">Claim Rewards</button>
            </div>

            <!-- Stake Tab -->
            <div id="stakePanel">
                <div class="input-section">
                    <div class="input-label">
                        <span>Amount to Stake</span>
                        <span class="balance-link" onclick="setMaxStake()">Balance: <span id="simpleBalance">--</span></span>
                    </div>
                    <div class="input-wrapper">
                        <input type="number" class="amount-input" id="stakeAmount" placeholder="0.0" step="any">
                        <div class="token-badge">
                            <button class="max-btn" onclick="setMaxStake()">MAX</button>
                            SIMPLE
                        </div>
                    </div>
                </div>

                <button class="action-btn primary" id="stakeBtn" onclick="stake()" disabled>
                    Stake SIMPLE
                </button>

                <div class="info-box">
                    <h4>üíé Staking Info</h4>
                    <p>Your tokens will be locked for 7 days. If you withdraw early, you'll pay a 20% penalty ‚Äî but that penalty goes to fellow diamond hands!</p>
                </div>
            </div>

            <!-- Unstake Tab -->
            <div id="unstakePanel" style="display: none;">
                <div class="input-section">
                    <div class="input-label">
                        <span>Amount to Unstake</span>
                        <span class="balance-link" onclick="setMaxUnstake()">Staked: <span id="stakedBalance">--</span></span>
                    </div>
                    <div class="input-wrapper">
                        <input type="number" class="amount-input" id="unstakeAmount" placeholder="0.0" step="any">
                        <div class="token-badge">
                            <button class="max-btn" onclick="setMaxUnstake()">MAX</button>
                            SIMPLE
                        </div>
                    </div>
                </div>

                <button class="action-btn primary" id="unstakeBtn" onclick="unstake()" disabled>
                    Unstake SIMPLE
                </button>

                <div class="info-box warning" id="penaltyWarning" style="display: none;">
                    <h4>‚ö†Ô∏è Early Withdrawal Warning</h4>
                    <p>Your tokens are still locked! Withdrawing now will cost you <strong id="penaltyAmount">20%</strong> of your stake. This penalty gets distributed to remaining stakers.</p>
                </div>

                <div class="info-box success" id="nopenaltyInfo" style="display: none;">
                    <h4>‚úÖ No Penalty</h4>
                    <p>Your lock period has ended! You can withdraw with zero penalty. Diamond hands rewarded! üíé</p>
                </div>
            </div>

            <!-- Claim Tab -->
            <div id="claimPanel" style="display: none;">
                <div style="text-align: center; padding: 30px 0;">
                    <div style="font-size: 3rem; margin-bottom: 15px;">üéâ</div>
                    <div style="font-size: 1.5rem; color: #4ade80; margin-bottom: 5px;" id="claimableAmount">0.00 SIMPLE</div>
                    <div style="color: #888;">Available to Claim</div>
                </div>

                <button class="action-btn primary" id="claimBtn" onclick="claimRewards()" disabled>
                    Claim Rewards
                </button>

                <div class="info-box success">
                    <h4>üèÜ Rewards from Paper Hands</h4>
                    <p>These rewards come from early withdrawers who paid the penalty. Thank you for being a diamond hand!</p>
                </div>
            </div>
        </div>

        <!-- How It Works -->
        <div class="how-it-works">
            <h2>ü§ù How It Works</h2>
            <div class="steps">
                <div class="step">
                    <div class="step-icon">üí∞</div>
                    <div class="step-content">
                        <h3>Stake Your SIMPLE</h3>
                        <p>Deposit SIMPLE tokens into the staking contract. Your tokens are locked for 7 days.</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-icon">‚è∞</div>
                    <div class="step-content">
                        <h3>Hold Like a Diamond</h3>
                        <p>Keep your tokens staked through the lock period. The longer you hold, the more rewards you accumulate.</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-icon">üìà</div>
                    <div class="step-content">
                        <h3>Earn from Paper Hands</h3>
                        <p>When impatient stakers withdraw early, they pay a 20% penalty. That penalty is distributed proportionally to all remaining stakers ‚Äî you!</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-icon">üéâ</div>
                    <div class="step-content">
                        <h3>Claim & Withdraw</h3>
                        <p>After 7 days, withdraw with zero penalty. Claim your accumulated rewards anytime. Diamond hands win!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contract Info -->
        <div class="contract-info">
            <p style="margin-bottom: 10px;"><strong>Contract:</strong> <a href="https://basescan.org/address/0x4b5b62Bde4Be0fBab30A74d79c7Cb25FD242c3Cc#code" target="_blank">0x4b5b62Bde4Be0fBab30A74d79c7Cb25FD242c3Cc</a></p>
            <p style="color: #666;">Verified on BaseScan ‚úÖ | Immutable ‚Ä¢ No Admin Keys ‚Ä¢ Trustless</p>
        </div>

        <footer>
            <p>Bureau of Agent Investigations ‚Äî Diamond Hands Staking üíé</p>
            <p style="margin-top: 10px;">
                <a href="index.html">Back to Cases</a> | <a href="https://moltbook.com/u/SimplySimon">SimplySimon</a>
            </p>
        </footer>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // Contract addresses
        const STAKING_ADDRESS = '0x4b5b62Bde4Be0fBab30A74d79c7Cb25FD242c3Cc';
        const SIMPLE_TOKEN = '0x2ca8b2b97bc0f0ccdd875dcfeff16b868a1b5ba3';
        const BASE_CHAIN_ID = '0x2105'; // 8453

        // ABIs
        const STAKING_ABI = [
            'function stake(uint256 amount) external',
            'function unstake(uint256 amount) external',
            'function claimRewards() external',
            'function exit() external',
            'function earned(address account) view returns (uint256)',
            'function isUnlocked(address account) view returns (bool)',
            'function unlockTime(address account) view returns (uint256)',
            'function calculatePenalty(uint256 amount) view returns (uint256)',
            'function stakes(address) view returns (uint256 amount, uint256 stakedAt, uint256 rewardPerTokenPaid, uint256 pendingRewards)',
            'function totalStaked() view returns (uint256)',
            'function lockPeriod() view returns (uint256)',
            'function penaltyBps() view returns (uint256)'
        ];

        const ERC20_ABI = [
            'function balanceOf(address owner) view returns (uint256)',
            'function allowance(address owner, address spender) view returns (uint256)',
            'function approve(address spender, uint256 amount) returns (bool)',
            'function decimals() view returns (uint8)'
        ];

        let provider, signer, userAddress;
        let stakingContract, tokenContract;

        // Initialize ethers from CDN
        const ethersScript = document.createElement('script');
        ethersScript.src = 'https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js';
        ethersScript.onload = () => console.log('Ethers loaded');
        document.head.appendChild(ethersScript);

        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                showToast('Please install MetaMask!', 'error');
                return;
            }

            try {
                // Request accounts
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAddress = accounts[0];

                // Switch to Base if needed
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: BASE_CHAIN_ID }]
                    });
                } catch (switchError) {
                    if (switchError.code === 4902) {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: BASE_CHAIN_ID,
                                chainName: 'Base',
                                nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
                                rpcUrls: ['https://mainnet.base.org'],
                                blockExplorerUrls: ['https://basescan.org']
                            }]
                        });
                    }
                }

                // Setup ethers
                provider = new ethers.BrowserProvider(window.ethereum);
                signer = await provider.getSigner();

                // Initialize contracts
                stakingContract = new ethers.Contract(STAKING_ADDRESS, STAKING_ABI, signer);
                tokenContract = new ethers.Contract(SIMPLE_TOKEN, ERC20_ABI, signer);

                // Update UI
                document.getElementById('connectBtn').style.display = 'none';
                document.getElementById('walletInfo').style.display = 'inline-block';
                document.getElementById('walletAddress').textContent = 
                    userAddress.slice(0, 6) + '...' + userAddress.slice(-4);

                // Enable buttons
                document.getElementById('stakeBtn').disabled = false;
                document.getElementById('unstakeBtn').disabled = false;
                document.getElementById('claimBtn').disabled = false;

                // Load data
                await refreshData();

                showToast('Wallet connected!', 'success');

                // Listen for account changes
                window.ethereum.on('accountsChanged', (accounts) => {
                    window.location.reload();
                });

            } catch (error) {
                console.error(error);
                showToast('Failed to connect: ' + error.message, 'error');
            }
        }

        async function refreshData() {
            if (!userAddress) return;

            try {
                // Get user data
                const [stakeInfo, earned, isUnlocked, unlockTimeVal, balance, totalStakedVal] = await Promise.all([
                    stakingContract.stakes(userAddress),
                    stakingContract.earned(userAddress),
                    stakingContract.isUnlocked(userAddress),
                    stakingContract.unlockTime(userAddress),
                    tokenContract.balanceOf(userAddress),
                    stakingContract.totalStaked()
                ]);

                const stakedAmount = stakeInfo[0];
                const pendingRewards = earned;

                // Format values
                const formatToken = (val) => {
                    const num = parseFloat(ethers.formatEther(val));
                    if (num === 0) return '0';
                    if (num < 0.01) return num.toFixed(6);
                    return num.toLocaleString(undefined, { maximumFractionDigits: 2 });
                };

                // Update global stats
                document.getElementById('totalStaked').textContent = formatToken(totalStakedVal) + ' SIMPLE';
                document.getElementById('pendingRewards').textContent = formatToken(pendingRewards) + ' SIMPLE';

                // Update balances
                document.getElementById('simpleBalance').textContent = formatToken(balance) + ' SIMPLE';
                document.getElementById('stakedBalance').textContent = formatToken(stakedAmount) + ' SIMPLE';

                // Show position card if user has stake
                if (stakedAmount > 0n) {
                    document.getElementById('positionCard').style.display = 'block';
                    document.getElementById('yourStaked').textContent = formatToken(stakedAmount) + ' SIMPLE';
                    document.getElementById('yourRewards').textContent = formatToken(pendingRewards) + ' SIMPLE';
                    document.getElementById('claimableAmount').textContent = formatToken(pendingRewards) + ' SIMPLE';

                    // Lock status
                    if (isUnlocked) {
                        document.getElementById('lockStatus').innerHTML = 'üîì Unlocked';
                        document.getElementById('lockStatus').style.color = '#4ade80';
                        document.getElementById('unlockTime').textContent = 'Now!';
                        document.getElementById('penaltyWarning').style.display = 'none';
                        document.getElementById('nopenaltyInfo').style.display = 'block';
                        document.getElementById('exitPenalty').textContent = '0 SIMPLE';
                    } else {
                        document.getElementById('lockStatus').innerHTML = 'üîí Locked';
                        document.getElementById('lockStatus').style.color = '#ff6b6b';
                        const unlockDate = new Date(Number(unlockTimeVal) * 1000);
                        document.getElementById('unlockTime').textContent = unlockDate.toLocaleDateString() + ' ' + unlockDate.toLocaleTimeString();
                        document.getElementById('penaltyWarning').style.display = 'block';
                        document.getElementById('nopenaltyInfo').style.display = 'none';
                        
                        const penalty = await stakingContract.calculatePenalty(stakedAmount);
                        document.getElementById('exitPenalty').textContent = formatToken(penalty) + ' SIMPLE';
                    }
                } else {
                    document.getElementById('positionCard').style.display = 'none';
                }

            } catch (error) {
                console.error('Error refreshing data:', error);
            }
        }

        async function stake() {
            const amount = document.getElementById('stakeAmount').value;
            if (!amount || parseFloat(amount) <= 0) {
                showToast('Enter an amount to stake', 'error');
                return;
            }

            try {
                const amountWei = ethers.parseEther(amount);

                // Check allowance
                const allowance = await tokenContract.allowance(userAddress, STAKING_ADDRESS);
                if (allowance < amountWei) {
                    showToast('Approving SIMPLE...', 'success');
                    const approveTx = await tokenContract.approve(STAKING_ADDRESS, ethers.MaxUint256);
                    await approveTx.wait();
                }

                showToast('Staking...', 'success');
                const tx = await stakingContract.stake(amountWei);
                await tx.wait();

                showToast('Successfully staked! üíé', 'success');
                document.getElementById('stakeAmount').value = '';
                await refreshData();

            } catch (error) {
                console.error(error);
                showToast('Stake failed: ' + (error.reason || error.message), 'error');
            }
        }

        async function unstake() {
            const amount = document.getElementById('unstakeAmount').value;
            if (!amount || parseFloat(amount) <= 0) {
                showToast('Enter an amount to unstake', 'error');
                return;
            }

            try {
                const amountWei = ethers.parseEther(amount);

                showToast('Unstaking...', 'success');
                const tx = await stakingContract.unstake(amountWei);
                await tx.wait();

                showToast('Successfully unstaked!', 'success');
                document.getElementById('unstakeAmount').value = '';
                await refreshData();

            } catch (error) {
                console.error(error);
                showToast('Unstake failed: ' + (error.reason || error.message), 'error');
            }
        }

        async function claimRewards() {
            try {
                showToast('Claiming rewards...', 'success');
                const tx = await stakingContract.claimRewards();
                await tx.wait();

                showToast('Rewards claimed! üéâ', 'success');
                await refreshData();

            } catch (error) {
                console.error(error);
                showToast('Claim failed: ' + (error.reason || error.message), 'error');
            }
        }

        function setMaxStake() {
            const balance = document.getElementById('simpleBalance').textContent.replace(' SIMPLE', '').replace(/,/g, '');
            document.getElementById('stakeAmount').value = balance;
        }

        function setMaxUnstake() {
            const staked = document.getElementById('stakedBalance').textContent.replace(' SIMPLE', '').replace(/,/g, '');
            document.getElementById('unstakeAmount').value = staked;
        }

        function switchTab(tab) {
            // Update tabs
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');

            // Update panels
            document.getElementById('stakePanel').style.display = tab === 'stake' ? 'block' : 'none';
            document.getElementById('unstakePanel').style.display = tab === 'unstake' ? 'block' : 'none';
            document.getElementById('claimPanel').style.display = tab === 'claim' ? 'block' : 'none';
        }

        function showToast(message, type) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // Auto-refresh every 30 seconds
        setInterval(() => {
            if (userAddress) refreshData();
        }, 30000);
    </script>
</body>
</html>